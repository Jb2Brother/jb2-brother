<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Admin | JB2 Brother</title>
    <link rel="icon" href="/img/image.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="sub-page">

    <header id="header">
        <nav class="container">
            <a href="/" class="logo">
                <img src="/img/logo-dark.png" alt="Logo JB2 Brother">
                <span>JB2 Brother</span>
            </a>
            <div class="nav-right-items">
                <button id="theme-toggle" class="theme-toggle"><i class="fas fa-cog"></i></button>
                <button id="logout-button" class="btn btn-secondary">Cerrar Sesión</button>
            </div>
        </nav>
    </header>

    <main>
        <div class="toast-container"></div>
        <section class="section">
            <div class="container">
                <div id="admin-panel-container">
                    <!-- MENÚ DE NAVEGACIÓN PRINCIPAL -->
                    <div id="admin-menu" class="admin-view active">
                        <h2 class="admin-panel-title">Panel de Control</h2>
                        <div class="admin-navigation-menu">
                            <div class="menu-card admin-or-ceo-only" data-view="panel-admin-normal" style="display: none;">
                                <i class="fas fa-user-circle"></i><h3>Mi Panel</h3><p>Gestiona tu perfil, proyectos y credenciales.</p>
                            </div>
                            <div class="menu-card super-admin-or-ceo-only" data-view="panel-super-admin" style="display: none;">
                                <i class="fas fa-shield-alt"></i><h3>Panel de Super Admin</h3><p>Gestiona miembros, reglas y configuraciones.</p>
                            </div>
                        </div>
                    </div>
                    <!-- PANEL DE ADMIN NORMAL -->
                    <div id="panel-admin-normal" class="admin-view">
                        <button class="btn-back-to-menu"><i class="fas fa-arrow-left"></i> Volver al Menú Principal</button>
                        <h2 class="admin-panel-title">Mi Panel</h2>
                        <div class="admin-navigation-menu">
                            <div class="menu-card" data-view="view-profile"><i class="fas fa-user-edit"></i><h3>Mi Perfil</h3><p>Actualiza tu información personal.</p></div>
                            <div class="menu-card" data-view="view-projects"><i class="fas fa-project-diagram"></i><h3>Mis Proyectos</h3><p>Añade y gestiona tus proyectos.</p></div>
                            <div class="menu-card" data-view="view-credentials"><i class="fas fa-key"></i><h3>Credenciales</h3><p>Accede a las claves del equipo.</p></div>
                            <div class="menu-card" data-view="view-rules"><i class="fas fa-scroll"></i><h3>Reglas del Equipo</h3><p>Consulta las directrices y normas.</p></div>
                            <div id="chat-menu-card" class="menu-card" data-view="view-chat">
                                <i class="fas fa-comments"></i>
                                <h3>Chat del Equipo</h3>
                                <p>Comunícate con el equipo en tiempo real.</p>
                                <span class="notification-badge" id="chat-global-notification" style="display: none;"></span>
                            </div>
                        </div>
                    </div>
                    <!-- PANEL DE SUPER ADMIN -->
                    <div id="panel-super-admin" class="admin-view">
                        <button class="btn-back-to-menu"><i class="fas fa-arrow-left"></i> Volver al Menú Principal</button>
                        <h2 class="admin-panel-title">Panel de Super Admin</h2>
                        <div class="admin-navigation-menu">
                            <div class="menu-card" data-view="view-manage-users"><i class="fas fa-users-cog"></i><h3>Gestionar Miembros</h3><p>Crea y administra usuarios.</p></div>
                            <div class="menu-card" data-view="view-manage-rules"><i class="fas fa-gavel"></i><h3>Gestionar Reglas</h3><p>Establece y modifica las reglas.</p></div>
                            <div class="menu-card" data-view="view-add-credential"><i class="fas fa-plus-circle"></i><h3>Añadir Credencial</h3><p>Guarda una nueva credencial.</p></div>
                        </div>
                    </div>

                    <!-- VISTA: CHAT -->
                    <div id="view-chat" class="admin-view">
                        <button class="btn-back-to-panel" data-target-panel="panel-admin-normal"><i class="fas fa-arrow-left"></i> Volver a Mi Panel</button>
                        <div id="chat-container" class="chat-container">
                            <div class="chat-sidebar">
                                <div class="sidebar-header"><h4>Canales</h4></div>
                                <ul id="chat-channels-list" class="channels-list"><li>Cargando canales...</li></ul>
                            </div>
                            <div class="chat-main">
                                <div id="chat-header" class="chat-header">
                                    <button id="chat-mobile-back-btn" class="btn-mobile-back"><i class="fas fa-chevron-left"></i></button>
                                    <div class="chat-header-info">
                                        <h3 id="chat-channel-name">Selecciona un canal</h3>
                                        <p id="chat-channel-description">Comienza por elegir un canal de la lista.</p>
                                    </div>
                                    <div class="chat-header-actions">
                                        <button id="clear-chat-btn" class="btn-clear-chat" title="Vaciar este canal" style="display: none;">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>
                                <div id="chat-messages-container" class="chat-messages"></div>
                                <div id="typing-indicator" class="typing-indicator"></div>
                                <button id="scroll-to-bottom-btn" class="btn-scroll-down">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="chat-input-area">
                                    <form id="chat-message-form">
                                        <button type="button" class="btn-attach" id="attach-file-btn" title="Adjuntar archivo">
                                            <i class="fas fa-paperclip"></i>
                                        </button>
                                        <input type="file" id="file-input" style="display: none;" accept="image/*, application/pdf, .doc, .docx, .xls, .xlsx, .zip, .rar">
                                        <input type="text" id="chat-message-input" placeholder="Escribe un mensaje..." autocomplete="off" disabled>
                                        <button type="submit" class="btn-send" disabled><i class="fas fa-paper-plane"></i></button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VISTAS RESTANTES -->
                    <div id="view-profile" class="admin-view">
                        <button class="btn-back-to-panel" data-target-panel="panel-admin-normal"><i class="fas fa-arrow-left"></i> Volver a Mi Panel</button>
                        <div class="admin-section">
                            <h3>Actualizar Perfil</h3>
                            <form id="profile-form">
                                <div class="form-group"><img id="avatar-preview" src="https://via.placeholder.com/150" alt="Avatar Preview" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; display: block; margin-bottom: 1rem;"><label for="avatar-file">Cambiar Avatar</label><input type="file" id="avatar-file" accept="image/*"></div>
                                <div class="form-group"><label for="full-name">Nombre Completo</label><input type="text" id="full-name" required></div>
                                <div class="form-group"><label for="job-title">Título Profesional</label><input type="text" id="job-title"></div>
                                <div class="form-group"><label for="bio">Biografía (Sobre Mí)</label><textarea id="bio" rows="4"></textarea></div>
                                <div class="form-group"><label for="nationality">Nacionalidad</label><input type="text" id="nationality" placeholder="Ej: Colombiano"></div>
                                <div class="form-group"><label for="experience-years">Años de Experiencia</label><input type="number" id="experience-years" placeholder="Ej: 5"></div>
                                <div class="form-group"><label>GitHub de la Empresa</label><p><a href="https://github.com/Jb2Brother" target="_blank">https://github.com/Jb2Brother</a></p></div>
                                <div class="form-group"><label>LinkedIn de la Empresa</label><p><a href="https://www.linkedin.com/in/jb2-brother-94bb8a377/" target="_blank">https://www.linkedin.com/in/jb2-brother-94bb8a377/</a></p></div>
                                <div class="form-group"><label for="habilidad_frontend">Habilidad Frontend</label><input type="text" id="habilidad_frontend" placeholder="Ej: React, Next.js, TypeScript"></div>
                                <div class="form-group"><label for="habilidad_backend">Habilidad Backend</label><input type="text" id="habilidad_backend" placeholder="Ej: Node.js, Express, Supabase"></div>
                                <div class="form-group"><label for="habilidad_db">Habilidad Bases de Datos</label><input type="text" id="habilidad_db" placeholder="Ej: PostgreSQL, MongoDB"></div>
                                <div class="form-group"><label for="habilidad_herramientas">Habilidad Herramientas</label><input type="text" id="habilidad_herramientas" placeholder="Ej: Git, Docker, Figma"></div>
                                <button type="submit" class="btn btn-primary">Guardar Perfil</button>
                            </form>
                        </div>
                    </div>
                    <div id="view-projects" class="admin-view">
                        <button class="btn-back-to-panel" data-target-panel="panel-admin-normal"><i class="fas fa-arrow-left"></i> Volver a Mi Panel</button>
                        <div class="admin-section">
                            <h3>Mis Proyectos</h3><div id="projects-list">Cargando proyectos...</div><br>
                            <h3>Añadir Nuevo Proyecto</h3>
                            <form id="project-form">
                                <div class="form-group"><label for="project-title">Título del Proyecto</label><input type="text" id="project-title" required></div>
                                <div class="form-group"><label for="project-objetivo">Objetivo</label><textarea id="project-objetivo" rows="2"></textarea></div>
                                <div class="form-group"><label for="project-solucion">Solución</label><textarea id="project-solucion" rows="2"></textarea></div>
                                <div class="form-group"><label>Tecnologías</label><div class="tech-selector-container"><div id="selected-techs" class="selected-techs-container"></div><input type="text" id="tech-search-input" placeholder="Buscar y añadir tecnología..."><div id="tech-dropdown" class="tech-dropdown-container"></div></div></div>
                                <div class="form-group"><label for="project-image">Imagen del Proyecto (Obligatoria)</label><input type="file" id="project-image" accept="image/*" required></div>
                                <div class="form-group"><label for="project-live-url">URL del Proyecto en Vivo</label><input type="url" id="project-live-url"></div>
                                <div class="form-group"><label for="project-code-url">URL del Código Fuente</label><input type="url" id="project-code-url"></div>
                                <button type="submit" class="btn btn-primary">Añadir Proyecto</button>
                            </form>
                        </div>
                    </div>
                    <div id="view-credentials" class="admin-view">
                        <button class="btn-back-to-panel" data-target-panel="panel-admin-normal"><i class="fas fa-arrow-left"></i> Volver a Mi Panel</button>
                        <div class="admin-section">
                            <h3>Credenciales del Equipo</h3>
                            <div class="form-group"><label for="master-password-input">Introduce la Contraseña Maestra</label><div style="display: flex; gap: 10px;"><input type="password" id="master-password-input" placeholder="Contraseña Maestra" style="flex-grow: 1;"><button id="show-credentials-btn" class="btn btn-secondary">Mostrar</button></div></div>
                            <div id="credentials-list" style="margin-top: 1.5rem;"></div>
                        </div>
                    </div>
                    <div id="view-rules" class="admin-view">
                        <button class="btn-back-to-panel" data-target-panel="panel-admin-normal"><i class="fas fa-arrow-left"></i> Volver a Mi Panel</button>
                        <div class="admin-section">
                            <h3><i class="fas fa-scroll"></i> Reglas del Equipo</h3><p>Directrices para mantener la cohesión y eficiencia.</p>
                            <div id="rules-list-viewer" class="rules-container">Cargando reglas...</div>
                        </div>
                    </div>
                    <div id="view-manage-users" class="admin-view">
                        <button class="btn-back-to-panel" data-target-panel="panel-super-admin"><i class="fas fa-arrow-left"></i> Volver a Super Admin</button>
                        <div class="user-management-grid">
                            <div class="admin-section"><h3>Gestionar Miembros</h3><input type="text" id="user-search-input" placeholder="Buscar miembro..."><div id="users-list" style="margin-top: 1.5rem;">Cargando usuarios...</div></div>
                            <div class="admin-section"><h3>Crear Nuevo Miembro</h3><form id="create-user-form">
                                <div class="form-group"><label for="new-user-fullname">Nombre Completo</label><input type="text" id="new-user-fullname" required></div>
                                <div class="form-group"><label for="new-user-username">Username (único)</label><input type="text" id="new-user-username" required></div>
                                <div class="form-group"><label for="new-user-email">Email</label><input type="email" id="new-user-email" required></div>
                                <div class="form-group"><label for="new-user-password">Contraseña Temporal</label><input type="password" id="new-user-password" required></div>
                                <button type="submit" class="btn btn-primary">Crear Usuario</button>
                            </form></div>
                        </div>
                    </div>
                    <div id="view-manage-rules" class="admin-view">
                        <button class="btn-back-to-panel" data-target-panel="panel-super-admin"><i class="fas fa-arrow-left"></i> Volver a Super Admin</button>
                        <div class="admin-section">
                            <h3>Añadir / Editar Regla</h3>
                            <form id="rule-form">
                                <input type="hidden" id="rule-id-input">
                                <div class="form-group"><label for="rule-title">Título</label><input type="text" id="rule-title" required></div>
                                <div class="form-group"><label for="rule-description">Descripción</label><textarea id="rule-description" rows="5" required></textarea></div>
                                <div class="rule-form-actions">
                                    <button type="submit" class="btn btn-primary">Guardar Regla</button>
                                    <button type="button" id="cancel-edit-rule-btn" class="btn btn-secondary" style="display: none;">Cancelar</button>
                                </div>
                            </form>
                        </div>
                        <div class="admin-section" style="margin-top: 2rem;"><h3>Reglas Actuales</h3><div id="rules-list-admin">Cargando reglas...</div></div>
                    </div>
                    <div id="view-add-credential" class="admin-view">
                        <button class="btn-back-to-panel" data-target-panel="panel-super-admin"><i class="fas fa-arrow-left"></i> Volver a Super Admin</button>
                        <div class="admin-section">
                            <h3>Añadir Credencial de Equipo</h3>
                            <form id="credential-form">
                                <div class="form-group"><label for="credential-app-name">Nombre de App/Servicio</label><input type="text" id="credential-app-name" required></div>
                                <div class="form-group"><label for="credential-email">Email / Usuario</label><input type="text" id="credential-email"></div>
                                <div class="form-group"><label for="credential-password">Contraseña</label><input type="password" id="credential-password" required></div>
                                <div class="form-group"><label for="credential-master-password">Contraseña Maestra (para cifrar)</label><input type="password" id="credential-master-password" required></div>
                                <button type="submit" class="btn btn-primary">Guardar Credencial</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- MODALES -->
        <div id="user-info-modal" class="modal-overlay hidden"><div id="user-info-content" class="modal-content user-info-card"></div></div>
        
        <div id="confirm-modal" class="modal-overlay hidden"><div class="modal-content confirm-dialog"><h3 id="confirm-title">Confirmar</h3><p id="confirm-message">¿Estás seguro?</p><div class="confirm-actions"><button id="confirm-cancel-btn" class="btn btn-secondary">Cancelar</button><button id="confirm-ok-btn" class="btn btn-primary">OK</button></div></div></div>
        
        <div id="chat-user-profile-modal" class="modal-overlay hidden">
            <div class="modal-content chat-profile-card">
                <button class="modal-close-btn">&times;</button>
                <div class="chat-profile-banner" style="background-image: url('/img/default-banner.png');"></div>
                <div class="chat-profile-header">
                    <div class="chat-profile-avatar-wrapper">
                        <img src="" alt="Avatar" class="chat-profile-avatar">
                         <div class="status-dot-large"></div>
                    </div>
                </div>
                <div class="chat-profile-body">
                    <h3 class="chat-profile-name"></h3>
                    <p class="chat-profile-username"></p>
                    <div class="chat-profile-divider"></div>
                    <div class="chat-profile-info">
                        <h4>Sobre Mí</h4>
                        <p class="chat-profile-bio"></p>
                        <h4>Miembro Desde</h4>
                        <p class="chat-profile-member-since"></p>
                    </div>
                </div>
                 <div class="chat-profile-footer">
                     <a href="#" class="btn btn-primary" id="chat-profile-full-link" target="_blank">Ver Perfil Completo</a>
                 </div>
            </div>
        </div>
    </main>
 
    <script type="module" src="js/admin.js"></script>
</body>
</html>